title  DNS-Cache-Poisoning

participant User
participant Attacker
participant Victim-DNS
participant Root-Server
participant Appropriate-DNS
participant Attacker-DNS

loop until: FakeIP == Attackers Choosen IP
    Attacker->Victim-DNS: DNS-Request: [victim.com]
    note right of Victim-DNS: No entry in cache
    Victim-DNS->Root-Server: DNS-Request: [victim.com]
    Root-Server->Victim-DNS: DNS-Response: [victim.com, NS=nsIP]
    Victim-DNS->Appropriate-DNS: DNS-Request: [victim.com, ID #m]
    Attacker->Victim-DNS: DNS-Response: [victim.com, validIP, AR=PoisonNS, ID #1]
    Attacker->Victim-DNS: DNS-Response: [victim.com, validIP, AR=PoisonNS, ID #2]
    Attacker->Victim-DNS: ...
    Attacker->Victim-DNS: DNS-Response: [victim.com, validIP, AR=PoisonNS, ID #m]
    Attacker->Victim-DNS: ...
    Attacker->Victim-DNS: DNS-Response: [victim.com, validIP, AR=PoisonNS, ID #n]
    Appropriate-DNS->Victim-DNS: DNS-Response: [victim.com, validIP, ID #m]
    note right of Victim-DNS: Response was to slow
    Victim-DNS->Attacker-DNS: DNS-Request: [victim.com]
    Attacker-DNS->Victim-DNS: DNS-Response: [victim.com, fakeIP]
    Victim-DNS->Attacker: DNS-Response: [victim.com, fakeIP]

end
User->Victim-DNS: DNS-Request: [user.victim.com, ID]
note right of  Victim-DNS: Found poisoned ns entry
Victim-DNS->Attacker-DNS: DNS-Request: [user.victim.com, ID]
Attacker-DNS->Victim-DNS: DNS-Response: [user.victim.com, FakeIP, ID]
Victim-DNS->User: DNS-Response: [user.victim.com, FakeIP, ID]
